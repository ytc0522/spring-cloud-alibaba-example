
#Nacos 服务注册原理

## Nacos服务注册流程
### 客户端侧
- Nacos客户端会将自己的信息通过Http POST接口发送给Nacos服务端。 自身的信息包括： 
服务名称、命名空间id、分组名称、集群名称、权重、是否是临时实例、元数据
- 如果客户端是临时实例，那么还会开启一个心跳检查任务，定时上报自身的信息。

### 服务端侧
- Nacos服务端接收到数据后，首先将客户端的服务信息放入到一个Map(namespace, Map(group::serviceName, Service))中
- 启动定时任务定时检查服务的健康状态，以及判断是否需要删除。
- Nacos将请求放入到一个阻塞队列中，有专门的线程监听这个阻塞队列，在service的onChange方法中更新服务列表，然后发布服务改变事件，通过UDP推送给给到该服务所有的实例。 
- 然后同步数据给其他集群节点。


